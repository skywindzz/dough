(function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},n={},r=function(t,e){return{}.hasOwnProperty.call(t,e)},i=function(t,e){var n,r,i=[];n=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var o=0,a=n.length;a>o;o++)r=n[o],".."===r?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},o=function(t){return t.split("/").slice(0,-1).join("/")},a=function(e){return function(n){var r=o(e),a=i(r,n);return t.require(a,e)}},s=function(t,e){var r={id:t,exports:{}};e(r.exports,a(t),r);var i=n[t]=r.exports;return i},u=function(t,o){var a=i(t,".");if(null==o&&(o="/"),r(n,a))return n[a];if(r(e,a))return s(a,e[a]);var u=i(a,"./index");if(r(n,u))return n[u];if(r(e,u))return s(u,e[u]);throw Error('Cannot find module "'+t+'" from '+'"'+o+'"')},l=function(t,n){if("object"==typeof t)for(var i in t)r(t,i)&&(e[i]=t[i]);else e[t]=n},c=function(){var t=[];for(var n in e)r(e,n)&&t.push(n);return t};t.require=u,t.require.define=l,t.require.register=l,t.require.list=c,t.require.brunch=!0}})(),require.register("application",function(t,e,n){var r,i,o,a,s,u,l,c,h,f,p={}.hasOwnProperty,d=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};a=e("chaplin"),c=e("mediator"),h=e("routes"),l=e("models/user"),o=e("models/canvas"),u=e("models/nodes"),s=e("models/links"),i=e("models/axes"),n.exports=r=function(t){function e(){return f=e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.initRouter(h,{root:window.location.pathname}),this.initDispatcher({controllerSuffix:"-controller"}),this.initLayout(),this.initComposer(),this.initMediator(),this.startRouting(),"function"==typeof Object.freeze?Object.freeze(this):void 0},e.prototype.initMediator=function(){return c.current_user=new l("undefined"!=typeof payload&&null!==payload?payload.current_user:void 0),c.canvas=new o({_id:"undefined"!=typeof payload&&null!==payload?payload.composition:void 0}),c.nodes=new u,c.links=new s,c.axes=new i,c.outer=void 0,c.stage=void 0,c.vis=void 0,c.vis_axes=void 0,c.defs=void 0,c.controls=void 0,c.offset=[],c.node=void 0,c.selected_node=void 0,c.link=void 0,c.selected_link=void 0,c.axis=void 0,c.selected_axis=void 0,c.seal()},e}(a.Application)}),require.register("config",function(t,e,n){var r,i;switch(r={development:{core_url:"http://localhost:3000",image_url:"http://localhost:3333/images/",api:{base_url:"http://localhost:3000"}},production:{core_url:"http://alpha.ideavis.co",image_url:"http://ideavis-alpha-client.herokuapp.com/images/",api:{base_url:"http://alpha.ideavis.co"}}},window.location.hostname){case"alpha.ideavis.co":case"ideavis-alpha-core.herokuapp.com":case"ideavis-alpha-client.herokuapp.com":i="production";break;default:i="development"}n.exports=r[i]}),require.register("controllers/base/controller",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(r.Controller)}),require.register("controllers/canvas-controller",function(t,e,n){var r,i,o,a,s,u,l,c={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};u=e("mediator"),a=e("controllers/base/controller"),r=e("models/canvas"),o=e("views/canvas-view"),s=void 0,n.exports=i=function(t){function n(){return l=n.__super__.constructor.apply(this,arguments)}return h(n,t),n.prototype.index=function(){var t;this.model=u.canvas;try{s=e("editor/views/editor-view"),this.view=new s({model:this.model})}catch(n){t=n,this.view=new o({model:this.model})}return this.model.fetch()},n}(a)}),require.register("initialize",function(t,e){var n;n=e("application"),$(function(){return(new n).initialize(),FastClick.attach(document.body)})}),require.register("lib/support",function(t,e,n){var r,i,o;r=e("chaplin"),o=e("lib/utils"),i=o.beget(r.support),n.exports=i}),require.register("lib/utils",function(t,e,n){var r,i;r=e("chaplin"),i=r.utils.beget(r.utils),n.exports=i}),require.register("lib/view-helper",function(t,e){var n,r=[].slice;n=e("chaplin"),Handlebars.registerHelper("with",function(t,e){return!t||Handlebars.Utils.isEmpty(t)?e.inverse(this):e.fn(t)}),Handlebars.registerHelper("without",function(t,e){var n;return n=e.inverse,e.inverse=e.fn,e.fn=n,Handlebars.helpers["with"].call(this,t,e)}),Handlebars.registerHelper("url",function(){var t,e,i,o;return i=arguments[0],e=arguments.length>=3?r.call(arguments,1,o=arguments.length-1):(o=1,[]),t=arguments[o++],n.helpers.reverse(i,e)})}),require.register("mediator",function(t,e,n){n.exports=e("chaplin").mediator}),require.register("models/axes",function(t,e,n){var r,i,o,a,s,u,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("chaplin"),s=e("mediator"),a=e("models/base/collection"),i=e("models/axis"),n.exports=r=function(t){function e(){return this.axis_created=l(this.axis_created,this),u=e.__super__.constructor.apply(this,arguments)}return h(e,t),_.extend(e.prototype,o.SyncMachine),e.prototype.model=i,e.prototype.initialize=function(){return this.url="/compositions/"+s.canvas.id+"/axes/",this.fetch(),this.on("add",this.axis_created)},e.prototype.fetch=function(t){var n,r=this;return null==t&&(t={}),this.beginSync(),n=t.success,t.success=function(t,e){return"function"==typeof n&&n(t,e),r.finishSync()},e.__super__.fetch.call(this,t)},e.prototype.axis_created=function(t){return console.log("[pub] axis_created"),this.publishEvent("axis_created",t)},e}(a)}),require.register("models/axis",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("models/base/model"),n.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.defaults={endpoints:[[0,0],[0,0]],rotate:0,x:0,y:0,stroke:"#000",stroke_dasharray:[],stroke_linecap:"square",stroke_opacity:100,stroke_width:1,label_text:"Axis label",label_font_size:12,label_fill:"#999",label_fill_opacity:100,label_bold:!1,label_italic:!1,label_align:"start",label_spacing:0,label_offset_x:0,label_offset_y:5},e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),_.extend({},t)},e.prototype.save=function(){return console.log("[SAVE]"),e.__super__.save.apply(this,arguments),this.publishEvent("axis_updated",this)},e.prototype.destroy=function(){return e.__super__.destroy.apply(this,arguments),console.log("[AXIS DESTROYED]"),this.publishEvent("axis_removed",this.id)},e}(i)}),require.register("models/base/collection",function(t,e,n){var r,i,o,a,s={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),o=e("models/base/model"),n.exports=i=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.url=function(){var t;return t=e.__super__.url.apply(this,arguments),config.api.base_url+t},e.prototype.model=o,e}(r.Collection)}),require.register("models/base/model",function(t,e,n){var r,i,o,a,s={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("config"),r=e("chaplin"),n.exports=i=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.idAttribute="_id",e.prototype.url=function(){var t;return t=e.__super__.url.apply(this,arguments),o.api.base_url+t},e}(r.Model)}),require.register("models/base/relational-model",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}var n,i,a,u;for(s(e,t),_(e.prototype).extend(r.EventBroker),_(e.prototype).extend(r.SyncMachine),e.prototype.idAttribute="_id",e.prototype.url=function(){var t;return t=e.__super__.url.apply(this,arguments),config.api.base_url+t},i=["getAttributes","serialize","disposed"],a=0,u=i.length;u>a;a++)n=i[a],e.prototype[n]=r.Model.prototype[n];return e.prototype.dispose=function(){return this.disposed?void 0:(this.trigger("relational:unregister",this,this.collection),r.Model.prototype.dispose.call(this))},e}(Backbone.RelationalModel)}),require.register("models/canvas",function(t,e,n){var r,i,o,a,s,u=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("chaplin"),o=e("models/base/model"),a=e("models/palette"),n.exports=r=function(t){function e(){return this.update_palette=u(this.update_palette,this),this.build_palette=u(this.build_palette,this),this.canvas_attributes_updated=u(this.canvas_attributes_updated,this),s=e.__super__.constructor.apply(this,arguments)}return c(e,t),_.extend(e.prototype,i.SyncMachine),e.prototype.urlRoot="/compositions/",e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),_.extend({},t),this.on("sync",this.canvas_attributes_updated)},e.prototype.fetch=function(t){var n,r=this;return null==t&&(t={}),this.beginSync(),n=t.success,t.success=function(t,e){return"function"==typeof n&&n(t,e),r.build_palette(),r.finishSync()},e.__super__.fetch.call(this,t)},e.prototype.canvas_attributes_updated=function(){return console.log("[pub] canvas_attributes_updated"),this.publishEvent("canvas_attributes_updated",this)},e.prototype.build_palette=function(){return this.colors=new a(this.get("palette")),this.listenTo(this.colors,"add",this.update_palette),this.listenTo(this.colors,"change",this.update_palette),this.listenTo(this.colors,"remove",this.update_palette)},e.prototype.update_palette=function(){return console.log("update_palette"),this.set("palette",this.colors.toJSON()),this.save()},e}(o)}),require.register("models/color",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("models/base/model"),n.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(i)}),require.register("models/link",function(t,e,n){var r,i,o,a,s=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("models/base/model"),i=e("models/marker"),n.exports=r=function(t){function e(){return this.build_markers=s(this.build_markers,this),this.update_markers=s(this.update_markers,this),a=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.defaults={source:null,target:null,endpoints:[[0,0],[0,0]],midpoints:[],markers:[(new i).toJSON(),(new i).toJSON()],interpolation:"basis",stroke:"#3498db",stroke_dasharray:[],stroke_linecap:"round",stroke_opacity:50,stroke_width:5,fill:"none",label_text:"Label",label_font_size:12,label_fill:"#999",label_fill_opacity:100,label_bold:!1,label_italic:!1,label_align:"middle",label_spacing:0,label_offset_x:25,label_offset_y:5},e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),_.extend({},t),this.build_markers()},e.prototype.save=function(){return console.log("[SAVE]"),e.__super__.save.apply(this,arguments),this.publishEvent("link_updated",this)},e.prototype.destroy=function(){return e.__super__.destroy.apply(this,arguments),console.log("[LINK DESTROYED]"),this.publishEvent("link_removed",this.id)},e.prototype.update_markers=function(){var t;return console.log("Marker changed"),t=[this.marker_start.toJSON(),this.marker_end.toJSON()],this.save({markers:t})},e.prototype.build_markers=function(){return this.marker_start=new i(this.get("markers")[0]),this.marker_end=new i(this.get("markers")[1]),this.listenTo(this.marker_start,"change",this.update_markers),this.listenTo(this.marker_end,"change",this.update_markers)},e}(o)}),require.register("models/links",function(t,e,n){var r,i,o,a,s,u,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),s=e("mediator"),i=e("models/base/collection"),o=e("models/link"),n.exports=a=function(t){function e(){return this.link_created=l(this.link_created,this),u=e.__super__.constructor.apply(this,arguments)}return h(e,t),_.extend(e.prototype,r.SyncMachine),e.prototype.model=o,e.prototype.initialize=function(){return this.url="/compositions/"+s.canvas.id+"/links/",this.fetch(),this.on("add",this.link_created)},e.prototype.fetch=function(t){var n,r=this;return null==t&&(t={}),this.beginSync(),n=t.success,t.success=function(t,e){return"function"==typeof n&&n(t,e),r.finishSync()},e.__super__.fetch.call(this,t)},e.prototype.link_created=function(t){return console.log("[pub] link_created"),this.publishEvent("link_created",t)},e}(i)}),require.register("models/marker",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=e("models/base/model"),n.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.defaults={type:"none",fill:"none",offset_x:0,width:20},e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),_.extend({},t)},e}(i)}),require.register("models/node",function(t,e,n){var r,i,o,a,s,u,l,c={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("models/base/model"),a=e("models/paths"),o=e("models/path"),u=e("models/texts"),s=e("models/text"),n.exports=i=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.defaults={x:0,y:0,rotate:0,opacity:100,weight:1,nested:[(new o).toJSON(),(new s).toJSON()]},e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),_.extend({},t),this.build_nested()},e.prototype.destroy=function(){return e.__super__.destroy.apply(this,arguments),console.log("[NODE DESTROYED]"),this.publishEvent("node_removed",this.id)},e.prototype.save=function(){return e.__super__.save.apply(this,arguments),console.log("[NODE SAVED]"),this.publishEvent("node_updated",this)},e.prototype.build_nested=function(){return this.paths=new a(_.where(this.get("nested"),{type:"path"})),this.texts=new u(_.where(this.get("nested"),{type:"text"})),this.listenTo(this.paths,"change",this.update_nested),this.listenTo(this.texts,"change",this.update_nested)},e.prototype.update_nested=function(){var t;return t=[],_.each(this.paths.toJSON(),function(e){return t.push(e)}),_.each(this.texts.toJSON(),function(e){return t.push(e)}),this.save({nested:t})},e}(r)}),require.register("models/nodes",function(t,e,n){var r,i,o,a,s,u,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),s=e("mediator"),i=e("models/base/collection"),o=e("models/node"),n.exports=a=function(t){function e(){return this.poll=l(this.poll,this),this.node_created=l(this.node_created,this),u=e.__super__.constructor.apply(this,arguments)}return h(e,t),_.extend(e.prototype,r.SyncMachine),e.prototype.model=o,e.prototype.initialize=function(){return this.url="/compositions/"+s.canvas.id+"/nodes/",this.fetch(),this.on("add",this.node_created)},e.prototype.fetch=function(t){var n,r=this;return null==t&&(t={}),this.beginSync(),n=t.success,t.success=function(t,e){return"function"==typeof n&&n(t,e),r.finishSync()},e.__super__.fetch.call(this,t)},e.prototype.node_created=function(t){return console.log("[pub] node_created"),this.publishEvent("node_created",t)},e.prototype.poll=function(){return null!=this.poll_timeout&&(clearTimeout(this.poll_timeout),this.poll_timeout=null),this.poll_timeout=setInterval(function(){return s.nodes.fetch()},1500)},e}(i)}),require.register("models/palette",function(t,e,n){var r,i,o,a,s={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("models/base/collection"),i=e("models/color"),n.exports=o=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.model=i,e}(r)}),require.register("models/path",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("models/base/model"),n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.defaults={type:"path",shape:"circle",scale:1,height:100,width:100,fill:"#fbfbfb",fill_opacity:100,stroke_width:5,stroke:"#000",stroke_opacity:20,stroke_dasharray:[],stroke_linecap:"square",x:0,y:0,rotate:0},e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),_.extend({},t)},e}(r)}),require.register("models/paths",function(t,e,n){var r,i,o,a,s,u=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),i=e("models/base/collection"),o=e("models/path"),n.exports=a=function(t){function e(){return this.path_removed=u(this.path_removed,this),this.path_updated=u(this.path_updated,this),this.path_created=u(this.path_created,this),s=e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.model=o,e.prototype.initialize=function(){return this.on("add",this.path_created),this.on("change",this.path_updated),this.on("remove",this.path_removed)},e.prototype.path_created=function(){return console.log("[pub] path_created"),this.publishEvent("path_created",this)},e.prototype.path_updated=function(){return console.log("[pub] path_updated"),this.publishEvent("path_updated")},e.prototype.path_removed=function(t){return console.log("[pub] path_removed"),this.publishEvent("path_removed",t)},e}(i)}),require.register("models/text",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("models/base/model"),n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.defaults={type:"text",text:"Label",font_size:18,fill:"#333",fill_opacity:100,stroke_width:0,stroke:null,stroke_opacity:100,bold:!1,italic:!1,underline:!1,overline:!1,spacing:0,line_height:24,align:"middle",width:80,x:0,y:0},e.prototype.initialize=function(t){return e.__super__.initialize.apply(this,arguments),_.extend({},t)},e}(r)}),require.register("models/texts",function(t,e,n){var r,i,o,a,s,u=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),i=e("models/base/collection"),o=e("models/text"),n.exports=a=function(t){function e(){return this.text_removed=u(this.text_removed,this),this.text_updated=u(this.text_updated,this),this.text_created=u(this.text_created,this),s=e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.model=o,e.prototype.initialize=function(t){return null==t&&(t={}),this.on("add",this.text_created),this.on("change",this.text_updated),this.on("remove",this.text_removed)},e.prototype.text_created=function(){return console.log("[pub] text_created"),this.publishEvent("text_created",this)},e.prototype.text_updated=function(){return console.log("[pub] text_updated"),this.publishEvent("text_updated")},e.prototype.text_removed=function(t){return console.log("[pub] text_removed"),this.publishEvent("text_removed",t)},e}(i)}),require.register("models/user",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),i=e("models/base/model"),n.exports=o=function(t){function e(t){_.extend({},t),e.__super__.constructor.call(this,t)}return s(e,t),_.extend(e.prototype,r.SyncMachine),e.prototype.urlRoot="/users/",e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments)},e.prototype.fetch=function(t){var n,r=this;return null==t&&(t={}),this.beginSync(),n=t.success,t.success=function(t,e){return"function"==typeof n&&n(t,e),r.set(e),r.finishSync()},e.__super__.fetch.call(this,t)},e}(i)}),require.register("routes",function(t,e,n){n.exports=function(t){return t("","canvas#index")}}),require.register("views/axis-view",function(t,e,n){var r,i,o,a,s=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("mediator"),i=e("views/base/view"),n.exports=r=function(t){function e(){return this.drag_endpoint_end=s(this.drag_endpoint_end,this),this.drag_endpoint_move=s(this.drag_endpoint_move,this),this.drag_endpoint_start=s(this.drag_endpoint_start,this),this.build_points=s(this.build_points,this),this.build=s(this.build,this),this.reset=s(this.reset,this),a=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.autoRender=!0,e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),this.view=d3.select(this.el),this.label=this.view.selectAll("text"),this.textline=o.defs.append("svg:path").attr("id","axis_"+this.model.id+"_path").attr("class","textline"),this.subscribeEvent("clear_active",this.clear),this.listenTo(this.model,"change",this.reset)},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.build(),console.log("[AxisView Rendered]")},e.prototype.activate=function(){return this.view.classed("active",!0),console.log("active!"),this.build_points()},e.prototype.deactivate=function(){return this.view.selectAll("circle.center").remove(),this.view.selectAll("circle.endpoint").remove(),this.render()},e.prototype.reset=function(){return this.render(),this.build_points()},e.prototype.clear=function(){return this.view.classed("active",!1),this.deactivate()},e.prototype.build=function(){var t,e,n=this;return this.view.selectAll("path.baseline").remove(),t=this.view.selectAll("path.baseline").data([this.model]),t.enter().append("svg:path").attr("class","baseline").attr("stroke",function(t){return t.get("stroke")}).attr("stroke-dasharray",function(t){return t.get("stroke_dasharray")}).attr("stroke-linecap",function(t){return t.get("stroke_linecap")}).attr("stroke-linejoin",function(t){return t.get("stroke_linecap")}).attr("stroke-opacity",function(t){return t.get("stroke_opacity")/100}).attr("stroke-width",function(t){return t.get("stroke_width")}).attr("d",function(t){return"M "+t.get("endpoints")[0][0]+", "+t.get("endpoints")[0][1]+"L "+t.get("endpoints")[1][0]+", "+t.get("endpoints")[1][1]}),t.attr("stroke",function(t){return t.get("stroke")}).attr("stroke-dasharray",function(t){return t.get("stroke_dasharray")}).attr("stroke-linecap",function(t){return t.get("stroke_linecap")}).attr("stroke-linejoin",function(t){return t.get("stroke_linecap")}).attr("stroke-opacity",function(t){return t.get("stroke_opacity")/100}).attr("stroke-width",function(t){return t.get("stroke_width")}).attr("d",function(t){return"M "+t.get("endpoints")[0][0]+", "+t.get("endpoints")[0][1]+"L "+t.get("endpoints")[1][0]+", "+t.get("endpoints")[1][1]}),t.exit().remove(),this.view.selectAll("path.tickline").remove(),e=this.view.selectAll("path.tickline").data([this.model]),e.enter().insert("path","path.baseline").attr("class","tickline").attr("stroke",function(t){return t.get("stroke")}).attr("stroke-dasharray",function(t){return t.get("stroke_dasharray")}).attr("stroke-linecap",function(t){return t.get("stroke_linecap")}).attr("stroke-linejoin",function(t){return t.get("stroke_linecap")}).attr("stroke-opacity",function(t){return t.get("stroke_opacity")/100}).attr("stroke-width",function(t){var e;return e=t.get("stroke_width"),8>e?8:e}).attr("d",function(t){return"M "+t.get("endpoints")[0][0]+", "+t.get("endpoints")[0][1]+"L "+t.get("endpoints")[1][0]+", "+t.get("endpoints")[1][1]}).attr("visibility","hidden"),e.attr("stroke",function(t){return t.get("stroke")}).attr("stroke-dasharray",function(t){return t.get("stroke_dasharray")}).attr("stroke-linecap",function(t){return t.get("stroke_linecap")}).attr("stroke-linejoin",function(t){return t.get("stroke_linecap")}).attr("stroke-opacity",function(t){return t.get("stroke_opacity")/100}).attr("stroke-width",function(t){var e;return e=t.get("stroke_width"),8>e?8:e}).attr("d",function(t){return"M "+t.get("endpoints")[0][0]+", "+t.get("endpoints")[0][1]+"L "+t.get("endpoints")[1][0]+", "+t.get("endpoints")[1][1]}),e.exit().remove(),this.textline.attr("d",function(){return"M "+n.model.get("endpoints")[0][0]+", "+n.model.get("endpoints")[0][1]+"L "+n.model.get("endpoints")[1][0]+", "+n.model.get("endpoints")[1][1]}),this.label=this.label.data([this.model]),this.label.enter().append("svg:text").attr("font-family","Helvetica, sans-serif").attr("fill",function(t){return t.get("label_fill")}).attr("fill-opacity",function(t){return t.get("label_fill_opacity")/100}).attr("font-size",function(t){return t.get("label_font_size")}).attr("font-style",function(t){return t.get("label_italic")?"italic":"normal"}).attr("font-weight",function(t){return t.get("label_bold")?"bold":"normal"}).append("svg:textPath").attr("class","textpath").attr("xlink:href",function(t){return"#axis_"+t.id+"_path"}).attr("letter-spacing",function(t){return t.get("label_spacing")}).attr("startOffset",function(t){var e,n;return e=t.get("label_align"),n=t.get("label_offset_x"),"start"===e?n+"%":"end"===e?100-n+"%":"50%"}).attr("text-anchor",function(t){return t.get("label_align")}).append("svg:tspan").attr("class","tspan").attr("dy",function(t){return-1*t.get("label_offset_y")}).text(function(t){return t.get("label_text")}),this.label.attr("fill",function(t){return t.get("label_fill")}).attr("fill-opacity",function(t){return t.get("label_fill_opacity")/100}).attr("font-size",function(t){return t.get("label_font_size")}).attr("font-style",function(t){return t.get("label_italic")?"italic":"normal"}).attr("font-weight",function(t){return t.get("label_bold")?"bold":"normal"}).transition().ease("linear").selectAll(".textpath").attr("letter-spacing",function(t){return t.get("label_spacing")}).attr("startOffset",function(t){var e,n;return e=t.get("label_align"),n=t.get("label_offset_x"),"start"===e?n+"%":"end"===e?100-n+"%":"50%"}).attr("text-anchor",function(t){return t.get("label_align")}).selectAll(".tspan").attr("dy",function(t){return-1*t.get("label_offset_y")}).text(function(t){return t.get("label_text")}),this.label.exit().remove()},e.prototype.build_points=function(){var t,e,n,r=this;return this.view.selectAll("circle.center").remove(),t=this.view.selectAll("circle.center").data([this.model]),t.enter().append("svg:circle").attr("class","center").attr("cx",0).attr("cy",0).attr("r",5).attr("fill",function(){return r.model.get("stroke")}).attr("stroke","#fff").attr("stroke-width",2).attr("cursor","move"),t.exit().remove(),this.view.selectAll("circle.endpoint").remove(),e=[{x:this.model.get("endpoints")[0][0],y:this.model.get("endpoints")[0][1]},{x:this.model.get("endpoints")[1][0],y:this.model.get("endpoints")[1][1]}],n=this.view.selectAll("circle.endpoint").data(e),n.enter().append("svg:circle").attr("class","endpoint").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",5).attr("fill",function(){return r.model.get("stroke")}).attr("stroke","#fff").attr("stroke-width",2).attr("cursor","move").call(d3.behavior.drag().on("dragstart",this.drag_endpoint_start).on("drag",this.drag_endpoint_move).on("dragend",this.drag_endpoint_end)),n.exit().call(d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null)).remove()},e.prototype.drag_endpoint_start=function(){return d3.event.sourceEvent.stopPropagation()},e.prototype.drag_endpoint_move=function(t,e){return d3.event.sourceEvent.stopPropagation(),t.x=d3.event.x,t.y=t.y,d3.select(this.view.selectAll("circle.endpoint")[0][e]).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})},e.prototype.drag_endpoint_end=function(t,e){return 0===e?this.model.save({endpoints:[[t.x,t.y],this.model.get("endpoints")[1]]}):this.model.save({endpoints:[this.model.get("endpoints")[0],[t.x,t.y]]}),o.publish("refresh_canvas"),this.build()},e}(i)}),require.register("views/base/collection-view",function(t,e,n){var r,i,o,a,s={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),o=e("views/base/view"),n.exports=i=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.getTemplateFunction=o.prototype.getTemplateFunction,e}(r.CollectionView)}),require.register("views/base/view",function(t,e,n){var r,i,o,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=e("chaplin"),e("lib/view-helper"),n.exports=i=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.getTemplateFunction=function(){return this.template},e}(r.View)}),require.register("views/canvas-view",function(t,e,n){var r,i,o,a,s,u,l,c,h=function(t,e){return function(){return t.apply(e,arguments)}},f={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};u=e("mediator"),s=e("views/base/view"),l=e("views/templates/canvas"),a=e("views/node-view"),o=e("views/link-view"),r=e("views/axis-view"),n.exports=i=function(t){function e(){return this.reset_zoom=h(this.reset_zoom,this),this.canvas_zoom=h(this.canvas_zoom,this),this.refresh=h(this.refresh,this),this.build_axes=h(this.build_axes,this),this.remove_axis=h(this.remove_axis,this),this.update_axis=h(this.update_axis,this),this.add_axis=h(this.add_axis,this),c=e.__super__.constructor.apply(this,arguments)
}var n,i,s,f,d,g,m;return p(e,t),e.prototype.el="#canvas",e.prototype.template=l,e.prototype.initialize=function(){var t=this;return e.__super__.initialize.apply(this,arguments),console.log("Initializing CanvasView"),$(window).on("resize",this.refresh),key("command+1",this.reset_zoom),key("control+1",this.reset_zoom),this.model.synced(function(){return u.nodes.synced(function(){return u.links.synced(function(){return u.axes.synced(function(){return t.rendered?void 0:(t.render(),t.rendered=!0)})})})})},s={height:function(){return window.innerHeight},width:function(){return window.innerWidth}},n={height:s.height()-50,width:s.width(),x:[0,s.width()],y:[0,s.height()-50]},f=d3.scale.linear().domain([0,n.width]).range([0,n.width]),g=d3.scale.linear().domain([0,n.height]).range([0,n.height]),d=d3.svg.axis().scale(f).orient("top").tickPadding(-20).ticks(20).tickSize(-10,-5,0).tickSubdivide(5),m=d3.svg.axis().scale(g).orient("left").tickPadding(-12).ticks(10).tickSize(-10,-5,0).tickSubdivide(5),i=d3.layout.force(),i.on("tick",function(){return null!=u.node&&u.node.attr("opacity",function(t){return t.opacity}).attr("transform",function(t){return"translate("+t.x+","+t.y+") rotate("+t.rotate+")"}),null!=u.link?(u.link.selectAll("path.baseline, path.tickline").attr("d",function(t){var e,n,r,o,a,s,l,c;return c=_.findWhere(i.nodes(),{id:t.get("target")}),l=_.findWhere(i.nodes(),{id:t.get("source")}),a=t.get("interpolation"),null!=c&&null!=l?(r=u.defs.select("path#link_"+t.id+"_path"),o=t.get("endpoints"),s=t.get("midpoints"),e=[],e.push({x:l.x+o[0][0],y:l.y+o[0][1]}),_.each(s,function(t,n){return e.push({x:s[n][0],y:s[n][1]})}),e.push({x:c.x+o[1][0],y:c.y+o[1][1]}),n=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate(a)(e),r.attr("d",n),n):"M 0,0"}),u.link.selectAll(".textpath").attr("xlink:href",function(t){return"#link_"+t.id+"_path"})):void 0}),e.prototype.init_artifacts=function(){return _.each(u.nodes.models,function(t){return i.nodes().push({id:t.id,x:t.get("x"),y:t.get("y"),opacity:t.get("opacity")/100,rotate:t.get("rotate"),model:t})}),this.subscribeEvent("node_created",this.add_node),this.subscribeEvent("node_updated",this.update_node),this.subscribeEvent("node_removed",this.remove_node),this.build_nodes(),_.each(u.links.models,function(t){var e,n;return e=_.where(i.nodes(),{id:t.get("source")})[0],n=_.where(i.nodes(),{id:t.get("target")})[0],i.links().push({id:t.id,source:e,target:n,opacity:t.get("stroke_opacity")/100,model:t})}),this.subscribeEvent("link_created",this.add_link),this.subscribeEvent("link_updated",this.update_link),this.subscribeEvent("link_removed",this.remove_link),this.build_links(),this.subscribeEvent("axis_created",this.add_axis),this.subscribeEvent("axis_updated",this.update_axis),this.subscribeEvent("axis_removed",this.remove_axis),this.build_axes()},e.prototype.drag_node_start=function(){return u.publish("refresh_canvas"),d3.event.sourceEvent.stopPropagation()},e.prototype.drag_node_move=function(t){return d3.event.sourceEvent.stopPropagation(),t.rotate=t.model.get("rotate"),t.x=d3.event.x,t.y=d3.event.y,t.px=t.x,t.py=t.y,d3.select(this).attr("transform","translate("+t.x+","+t.y+") rotate("+t.rotate+")")},e.prototype.drag_node_end=function(){return u.publish("refresh_canvas")},e.prototype.add_node=function(t){return i.nodes().push({id:t.id,x:t.get("x"),y:t.get("y"),opacity:t.get("opacity")/100,rotate:t.get("rotate"),model:t}),this.build_nodes()},e.prototype.update_node=function(t){return _.each(i.nodes(),function(e){return e.id===t.id?(e.x=t.get("x"),e.y=t.get("y"),e.opacity=t.get("opacity")/100,e.rotate=t.get("rotate"),e.px=e.x,e.py=e.y):void 0}),this.refresh()},e.prototype.remove_node=function(t){var e,n;return n=_.findWhere(i.nodes(),{id:t}),e=i.nodes().indexOf(n),i.nodes().splice(e,1),this.refresh()},e.prototype.build_nodes=function(){var t;return t=d3.behavior.drag().on("dragstart",this.drag_node_start).on("drag",this.drag_node_move).on("dragend",this.drag_node_end),u.node=u.vis.selectAll("g.nodeGroup").data(i.nodes()),u.node.enter().append("svg:g").attr("class","nodeGroup").attr("cursor","pointer").attr("pointer-events","painted").attr("opacity",function(t){return t.model.get("opacity")/100}).attr("transform",function(t){return"translate("+t.x+","+t.y+") rotate("+t.model.get("rotate")+")"}).each(function(t){return t.view=new a({model:t.model,el:this})}).call(t),u.node.exit().remove(),this.refresh()},e.prototype.add_link=function(t){var e,n;return e=_.where(i.nodes(),{id:t.get("source")})[0],n=_.where(i.nodes(),{id:t.get("target")})[0],i.links().push({id:t.id,source:e,target:n,model:t}),this.build_links()},e.prototype.update_link=function(){return this.refresh()},e.prototype.remove_link=function(t){var e,n;return n=_.findWhere(i.links(),{id:t}),e=i.links().indexOf(n),i.links().splice(e,1),this.refresh()},e.prototype.build_links=function(){return u.link=u.vis.selectAll("g.linkGroup").data(i.links()),u.link.enter().insert("svg:g","g.nodeGroup").attr("class","linkGroup").each(function(t){return t.view=new o({model:t.model,el:this,source:t.source,target:t.target})}),u.link.exit().remove(),this.refresh()},e.prototype.add_axis=function(){return this.build_axes()},e.prototype.update_axis=function(){return this.build_axes()},e.prototype.remove_axis=function(){return this.refresh()},e.prototype.build_axes=function(){return u.axis=u.vis_axes.selectAll("g.axisGroup").data(u.axes.models),u.axis.enter().append("svg:g").attr("class","axisGroup").attr("pointer-events","all").attr("transform",function(t){return"translate("+t.get("x")+","+t.get("y")+") rotate("+t.get("rotate")+")"}).each(function(t){return t.view=new r({model:t,el:this})}),u.axis.attr("transform",function(t){return"translate("+t.get("x")+","+t.get("y")+") rotate("+t.get("rotate")+")"}),u.axis.exit().remove(),this.refresh()},e.prototype.render=function(){var t,r;return e.__super__.render.apply(this,arguments),console.log("Rendering CanvasView [...]"),this.zoom=d3.behavior.zoom().x(f).y(g).scaleExtent([.5,5]).on("zoom",this.canvas_zoom),u.outer=d3.select("#stage").append("svg:svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink").attr("pointer-events","all"),u.defs=u.outer.append("svg:defs"),u.stage=u.outer.append("svg:g").attr("id","canvas_wrapper").call(this.zoom),u.stage.append("svg:rect").attr("id","canvas_background").attr("fill","#fff"),u.stage.append("svg:g").attr("class","x axis").attr("visibility","hidden").call(d),u.stage.append("svg:g").attr("class","y axis").attr("visibility","hidden").call(m),u.stage.append("svg:rect").attr("id","canvas_elements_background").attr("fill","none"),u.vis=u.stage.append("svg:g").attr("id","canvas_elements"),u.vis_axes=u.vis.append("svg:g").attr("id","canvas_axes"),u.controls=u.stage.append("svg:g").attr("id","canvas_controls"),i.charge(0).gravity(0).linkStrength(0).size([n.width,n.height]),this.subscribeEvent("refresh_canvas",this.refresh),this.subscribeEvent("refresh_zoom",this.reset_zoom),this.init_artifacts(),0===$("#detail").length&&(t=$("#canvas_elements")[0].getBoundingClientRect().width,r=(n.width-940)/2,n.width>t)?(this.zoom.scale(1).translate([r,0]),u.vis.attr("transform","translate("+r+","+0+")")):void 0},e.prototype.refresh=function(){var t,e;return e=1.3*$("#detail").width()||0,t=$("#canvas_elements")[0].getBoundingClientRect(),n.x=t.width+e,n.y=Math.max(t.bottom-50,t.height)+50,e>0?(n.height=window.innerHeight-50,n.width=window.innerWidth-50):(n.height=window.innerHeight-40,n.width=window.innerWidth),$("svg, #canvas_background, #canvas_elements_background").attr("height",n.height).attr("width",n.width),$("#detail-wrapper").css("min-height",n.height+50),i.size([n.width,n.height]).start()},e.prototype.canvas_zoom=function(){var t,e,n,r,i,o,a,s;return u.offset=[(null!=(t=d3.event)?t.translate:void 0)||[0,0],(null!=(e=d3.event)?e.scale:void 0)||1],u.vis.attr("transform","translate("+((null!=(n=d3.event)?n.translate:void 0)||[0,0])+") scale("+((null!=(r=d3.event)?r.scale:void 0)||1)+")"),u.controls.attr("transform","translate("+((null!=(i=d3.event)?i.translate:void 0)||[0,0])+") scale("+((null!=(o=d3.event)?o.scale:void 0)||1)+")"),u.stage.select(".x.axis").call(d),u.stage.select(".y.axis").call(m),d3.selectAll("g.axis text").transition().ease("linear").style("opacity",1),(null!=(a=d3.event)?a.scale:void 0)>1?u.stage.attr("class","zoom_in"):1>(null!=(s=d3.event)?s.scale:void 0)?u.stage.attr("class","zoom_out"):u.stage.attr("class",null)},e.prototype.reset_zoom=function(){return this.zoom.scale(1).translate([0,0]),this.canvas_zoom(),!1},e}(s)}),require.register("views/link-view",function(t,e,n){var r,i,o,a,s=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};o=e("mediator"),i=e("views/base/view"),n.exports=r=function(t){function n(){return this.generate_marker_path=s(this.generate_marker_path,this),this.drag_midpoint_end=s(this.drag_midpoint_end,this),this.drag_midpoint_move=s(this.drag_midpoint_move,this),this.drag_midpoint_start=s(this.drag_midpoint_start,this),this.destroy_midpoint=s(this.destroy_midpoint,this),this.create_midpoint=s(this.create_midpoint,this),this.drag_endpoint_end=s(this.drag_endpoint_end,this),this.drag_endpoint_move=s(this.drag_endpoint_move,this),this.drag_endpoint_start=s(this.drag_endpoint_start,this),this.build_points=s(this.build_points,this),this.build_markers=s(this.build_markers,this),this.build_baseline=s(this.build_baseline,this),a=n.__super__.constructor.apply(this,arguments)}return l(n,t),n.prototype.autoRender=!0,n.prototype.initialize=function(t){var r;null==t&&(t={}),n.__super__.initialize.apply(this,arguments);try{this.zoom_helpers=e("/editor/lib/zoom-helpers"),this.mode="private"}catch(i){r=i,this.mode="public"}return this.source=t.source,this.target=t.target,this.label=d3.select(this.el).selectAll("text"),this.baseline=d3.select(this.el).selectAll("path.baseline"),this.tickline=d3.select(this.el).selectAll("path.tickline"),this.textline=o.defs.append("svg:path").attr("id","link_"+this.model.id+"_path").attr("class","textline"),this.marker_start=o.defs.selectAll("marker#link_"+this.model.id+"_marker_start"),this.marker_end=o.defs.selectAll("marker#link_"+this.model.id+"_marker_end"),this.selected_endpoint=null,this.selected_midpoint=null,this.subscribeEvent("clear_active",this.clear),this.listenTo(this.model,"change",this.build_baseline)},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.build_baseline(),console.log("[LinkView Rendered]")},n.prototype.remove=function(){var t,e,r,i,o,a;return this.zoom_helpers=null,null!=(t=this.baseline)&&t.remove(),null!=(e=this.tickline)&&e.remove(),null!=(r=this.textline)&&r.remove(),null!=(i=this.label)&&i.remove(),null!=(o=this.marker_start)&&o.remove(),null!=(a=this.marker_end)&&a.remove(),this.deactivate(),console.log("[LinkView Removed]"),n.__super__.remove.apply(this,arguments)},n.prototype.activate=function(){return d3.select(this.el).classed("active",!0),this.baseline.attr("visibility","hidden"),this.tickline.attr("visibility","visible").call(d3.behavior.drag().on("dragstart",this.create_midpoint)),this.build_points()},n.prototype.deactivate=function(){var t,e,n,r;return this.selected_endpoint=null,this.selected_midpoint=null,this.baseline.attr("visibility","visible"),this.tickline.attr("visibility","hidden").call(d3.behavior.drag().on("dragend",null)),null!=(t=this.endpoints)&&t.call(d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null)).remove(),null!=(e=this.midpoints)&&e.call(d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null)).remove(),null!=(n=this.controls)&&n.remove(),null!=(r=this.filter)?r.remove():void 0},n.prototype.clear=function(){return d3.select(this.el).classed("active",!1),this.deactivate()},n.prototype.build_baseline=function(){var t=this;return this.build_markers(),this.baseline=this.baseline.data([this.model]),this.baseline.enter().append("svg:path").attr("class","baseline").attr("pointer-events","stroke").attr("visibility","visible").attr("opacity",function(t){return t.get("stroke_opacity")/100}).attr("shape-rendering","geometricPrecision").attr("stroke",function(t){return t.get("stroke")}).attr("stroke-dasharray",function(t){return t.get("stroke_dasharray")}).attr("stroke-linecap",function(t){return t.get("stroke_linecap")}).attr("stroke-linejoin",function(t){return t.get("stroke_linecap")}).attr("stroke-width",function(t){return t.get("stroke_width")}).attr("fill",function(t){return t.get("fill")}).attr("marker-start",function(t){return"url(#link_"+t.id+"_marker_start)"}).attr("marker-end",function(t){return"url(#link_"+t.id+"_marker_end)"}),this.baseline.attr("opacity",function(t){return t.get("stroke_opacity")/100}).attr("stroke",function(t){return t.get("stroke")}).attr("stroke-dasharray",function(t){return t.get("stroke_dasharray")}).attr("stroke-linecap",function(t){return t.get("stroke_linecap")}).attr("stroke-linejoin",function(t){var e;return e=t.get("stroke_linecap"),"square"===e?"miter":"butt"===e?"bevel":e}).attr("stroke-width",function(t){return t.get("stroke_width")}).attr("fill",function(t){return t.get("fill")}),this.tickline=this.tickline.data([this.model]),this.tickline.enter().append("svg:path").attr("class","tickline").attr("pointer-events","stroke").attr("visibility","hidden").attr("opacity",function(t){return t.get("stroke_opacity")/100}).attr("shape-rendering","geometricPrecision").attr("stroke",function(){return t.baseline.attr("stroke")}).attr("stroke-dasharray",function(){return t.baseline.attr("stroke-dasharray")}).attr("stroke-linecap",function(){return t.baseline.attr("stroke-linecap")}).attr("stroke-linejoin",function(){return t.baseline.attr("stroke-linejoin")}).attr("stroke-width",function(){return t.baseline.attr("stroke-width")}).attr("fill",function(){return t.baseline.attr("fill")}).attr("marker-start",function(t){return"url(#link_"+t.id+"_marker_start)"}).attr("marker-end",function(t){return"url(#link_"+t.id+"_marker_end)"}),this.tickline.attr("opacity",function(){return t.baseline.attr("opacity")}).attr("stroke",function(){return t.baseline.attr("stroke")}).attr("stroke-dasharray",function(){return t.baseline.attr("stroke-dasharray")}).attr("stroke-linecap",function(){return t.baseline.attr("stroke-linecap")}).attr("stroke-linejoin",function(){return t.baseline.attr("stroke-linejoin")}).attr("stroke-width",function(){return t.baseline.attr("stroke-width")}).attr("fill",function(){return t.baseline.attr("fill")}),this.label=this.label.data([this.model]),this.label.enter().insert("text","path").attr("fill",function(t){return t.get("label_fill")}).attr("fill-opacity",function(t){return t.get("label_fill_opacity")/100}).attr("font-family","Helvetica, sans-serif").attr("font-size",function(t){return t.get("label_font_size")}).attr("font-style",function(t){return t.get("label_italic")?"italic":"normal"}).attr("font-weight",function(t){return t.get("label_bold")?"bold":"normal"}).append("svg:textPath").attr("class","textpath").attr("xlink:href",function(t){return"#link_"+t.id+"_path"}).attr("letter-spacing",function(t){return t.get("label_spacing")}).attr("startOffset",function(t){var e,n;return e=t.get("label_align"),n=t.get("label_offset_x"),"start"===e?n+"%":"end"===e?100-n+"%":"50%"}).attr("text-anchor",function(t){return t.get("label_align")}).append("svg:tspan").attr("class","tspan").attr("dy",function(t){return-1*t.get("label_offset_y")}).text(function(t){return t.get("label_text")}),this.label.attr("fill",function(t){return t.get("label_fill")}).attr("fill-opacity",function(t){return t.get("label_fill_opacity")/100}).attr("font-size",function(t){return t.get("label_font_size")}).attr("font-style",function(t){return t.get("label_italic")?"italic":"normal"}).attr("font-weight",function(t){return t.get("label_bold")?"bold":"normal"}).transition().ease("linear").selectAll(".textpath").attr("letter-spacing",function(t){return t.get("label_spacing")}).attr("startOffset",function(t){var e,n;return e=t.get("label_align"),n=t.get("label_offset_x"),"start"===e?n+"%":"end"===e?100-n+"%":"50%"}).attr("text-anchor",function(t){return t.get("label_align")}).selectAll(".tspan").attr("dy",function(t){return-1*t.get("label_offset_y")}).text(function(t){return t.get("label_text")})},n.prototype.build_markers=function(){var t=this;return this.marker_start=this.marker_start.data([this.model.marker_start]),this.marker_start.enter().append("svg:marker").attr("id","link_"+this.model.id+"_marker_start").attr("class","marker-start").attr("markerUnits","userSpaceOnUse").attr("orient","auto").attr("refY",0).append("svg:path"),this.marker_start.each(function(e){return t.generate_marker_path(e)}).attr("refX",function(t){return-1*t.get("offset_x")}).attr("viewBox",function(t){return t.viewbox}).attr("markerHeight",function(t){return t.markerHeight}).attr("markerWidth",function(t){return t.markerWidth}).selectAll("path").attr("d",function(t){return t.path}).attr("fill",function(e){return"none"===e.get("fill")?t.model.get("stroke"):e.get("fill")}),this.marker_end=this.marker_end.data([this.model.marker_end]),this.marker_end.enter().append("svg:marker").attr("id","link_"+this.model.id+"_marker_end").attr("class","marker-end").attr("markerUnits","userSpaceOnUse").attr("orient","auto").attr("refY",0).append("svg:path"),this.marker_end.each(function(e){return t.generate_marker_path(e)}).attr("refX",function(t){return t.get("offset_x")}).attr("viewBox",function(t){return t.viewbox}).attr("markerHeight",function(t){return t.markerHeight}).attr("markerWidth",function(t){return t.markerWidth}).selectAll("path").attr("d",function(t){return t.path}).attr("fill",function(e){return"none"===e.get("fill")?t.model.get("stroke"):e.get("fill")}),this.marker_start.exit().remove(),this.marker_end.exit().remove()},n.prototype.build_points=function(){var t,e,n;return console.log("building points"),o.controls.selectAll("g#link_controls").remove(),this.controls=o.controls.append("svg:g").attr("id","link_controls"),o.defs.selectAll("filter#link_point_drop_shadow").remove(),this.filter=o.defs.append("svg:filter").attr("id","link_point_drop_shadow").attr("x","-25%").attr("y","-15%").attr("height","150%").attr("width","150%"),this.filter.append("svg:feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1),this.filter.append("svg:feOffset").attr("dx",0).attr("dy",1),this.filter.append("svg:feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope","0.35"),e=this.filter.append("feMerge"),e.append("svg:feMergeNode"),e.append("svg:feMergeNode").attr("in","SourceGraphic"),t=[{x:this.source.x+this.model.get("endpoints")[0][0],y:this.source.y+this.model.get("endpoints")[0][1]},{x:this.target.x+this.model.get("endpoints")[1][0],y:this.target.y+this.model.get("endpoints")[1][1]}],this.controls.selectAll("circle.endpoint").remove(),this.endpoints=this.controls.selectAll("circle.endpoint").data(t).enter().append("svg:circle").attr("class","point endpoint").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",5).call(d3.behavior.drag().on("dragstart",this.drag_endpoint_start).on("drag",this.drag_endpoint_move).on("dragend",this.drag_endpoint_end)),n=[],_.each(this.model.get("midpoints"),function(t){return n.push({x:t[0],y:t[1]})}),this.controls.selectAll("circle.midpoint").remove(),this.midpoints=this.controls.selectAll("circle.midpoint").data(n),this.midpoints.enter().append("svg:circle").attr("class","point midpoint").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",5).call(d3.behavior.drag().on("dragstart",this.drag_midpoint_start).on("drag",this.drag_midpoint_move).on("dragend",this.drag_midpoint_end)),this.midpoints.exit().call(d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null)).remove()},n.prototype.drag_endpoint_start=function(t){return d3.event.sourceEvent.stopPropagation(),this.selected_endpoint=t},n.prototype.drag_endpoint_move=function(t,e){return d3.event.sourceEvent.stopPropagation(),this.selected_endpoint=null,t.x=d3.event.x,t.y=d3.event.y,d3.select(this.endpoints[0][e]).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})},n.prototype.drag_endpoint_end=function(t,e){return null===this.selected_endpoint?(0===e?(this.model.save({endpoints:[[t.x-this.source.x,t.y-this.source.y],this.model.get("endpoints")[1]]}),console.log("Updated Source endpoint")):(this.model.save({endpoints:[this.model.get("endpoints")[0],[t.x-this.target.x,t.y-this.target.y]]}),console.log("Updated Target endpoint")),o.publish("refresh_canvas")):void 0},n.prototype.create_midpoint=function(t){var e,n,r,i,a,s,u,l,c,h,f,p,d;return i=d3.event.sourceEvent,i.stopPropagation(),r=this.zoom_helpers.get_coordinates(i),d=[[r.x,r.y]],h=t.get("endpoints"),l=[this.source.x+h[0][0],this.source.y+h[0][1]],c=[this.target.x+h[1][0],this.target.y+h[1][1]],f=t.get("midpoints"),f.length>0?(u=[],u.push(l),_.each(f,function(t){return u.push(t)}),u.push(c),s=null,n=[],e=[],_.each(u,function(t,r){var i,o,a,l;return(u[r][0]<d[0][0]&&d[0][0]<(null!=(i=u[r+1])?i[0]:void 0)||u[r][0]>d[0][0]&&d[0][0]>(null!=(o=u[r+1])?o[0]:void 0))&&(u[r][1]<d[0][1]&&d[0][1]<(null!=(a=u[r+1])?a[1]:void 0)||u[r][1]>d[0][1]&&d[0][1]>(null!=(l=u[r+1])?l[1]:void 0))?(u.length-1===r+1?s="append":0===r&&(s="prepend"),n=u[r],e=u[r+1]):void 0}),"append"===s?this.model.save({midpoints:_.union(f,d)}):"prepend"===s?this.model.save({midpoints:_.union(d,f)}):(a=f.indexOf(e),p=f.splice(a,0,d[0]),this.model.save({midopints:p}))):this.model.save({midpoints:_.union(f,d)}),this.build_points(),o.publish("refresh_canvas")},n.prototype.destroy_midpoint=function(){var t;return t=this.model.get("midpoints"),t.splice(this.selected_midpoint.index,1),this.model.save({midpoints:t}),this.selected_midpoint=null,this.build_points(),o.publish("refresh_canvas")},n.prototype.drag_midpoint_start=function(t,e){return d3.event.sourceEvent.stopPropagation(),this.midpoints.classed("active",!1),d3.select(this.midpoints[0][e]).classed("active",!0),this.selected_midpoint=t,this.selected_midpoint.index=e},n.prototype.drag_midpoint_move=function(t,e){return d3.event.sourceEvent.stopPropagation(),t.x=d3.event.x,t.y=d3.event.y,d3.select(this.midpoints[0][e]).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})},n.prototype.drag_midpoint_end=function(t,e){var n;return n=this.model.get("midpoints"),n[e][0]=t.x,n[e][1]=t.y,this.model.save({midpoints:n}),o.publish("refresh_canvas")},n.prototype.generate_marker_path=function(t){var e,n,r,i,o,a,s,u,l,c,h;switch(e=this.model.get("stroke_width"),n=t.get("type"),r=t.get("width"),n){case"none":t.markerHeight=1,t.markerWidth=1,t.path="M 0,0",t.viewbox="0 0 0 0";break;case"circle":h=t.get("width")/2,t.markerHeight=r,t.markerWidth=r,t.path="M 0,0 m "+-1*h+",0 "+"a "+h+","+h+" 0 1,0 "+2*h+",0 "+"a "+h+","+h+" 0 1,0 "+-2*h+",0 ",t.viewbox=""+-1*h+" "+-1*h+" "+2*h+" "+2*h;break;case"square":u=-1*r/2,o=r/2,t.markerHeight=r,t.markerWidth=r,t.path="M "+u+","+u+" "+"L "+o+","+u+" "+"L "+o+","+o+" "+"L "+u+","+o+" Z",t.viewbox=""+u+" "+u+" "+t.markerWidth+" "+t.markerHeight;break;case"stem":l=-1*r/8,c=-1*r/2,a=r/8,s=r/2,t.markerHeight=r,t.markerWidth=4*a,t.path="M "+l+","+c+" "+"L "+a+","+c+" "+"L "+a+","+s+" "+"L "+l+","+s+" Z",t.viewbox=""+l+" "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"equal-arrow-start":i=.5*Math.sqrt(3)*r,l=-1*i,c=-1*r/2,s=r/2,t.markerHeight=r,t.markerWidth=i,t.path="M 0,"+c+" "+"L "+l+",0 "+"L 0,"+s+" Z",t.viewbox=""+l+" "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"equal-arrow-end":i=.5*Math.sqrt(3)*r,a=i,c=-1*r/2,s=r/2,t.markerHeight=r,t.markerWidth=i,t.path="M 0,"+c+" "+"L "+a+",0 "+"L 0,"+s+" Z",t.viewbox="0 "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"right-arrow-start":l=-1*r/2,c=-1*r/2,s=r/2,t.markerHeight=r,t.markerWidth=r/2,t.path="M 0,"+c+" "+"L "+l+",0 "+"L 0,"+s+" Z",t.viewbox=""+l+" "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"right-arrow-end":a=r/2,c=-1*r/2,s=r/2,t.markerHeight=r,t.markerWidth=r/2,t.path="M 0,"+c+" "+"L "+a+",0 "+"L 0,"+s+" Z",t.viewbox="0 "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"sharp-arrow-start":i=.6*r,l=-1*i,c=-1*r/2,s=r/2,t.markerHeight=r,t.markerWidth=r+r/5,t.path="M 0,0 L "+r/5+","+c+" "+"L "+l+",0 "+"L "+r/5+","+s+" Z",t.viewbox=""+l+" "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"sharp-arrow-end":i=.6*r,a=i,c=-1*r/2,s=r/2,t.markerHeight=r,t.markerWidth=r+r/5,t.path="M 0,0 L "+-1*r/5+","+c+" "+"L "+a+",0 "+"L "+-1*r/5+","+s+" Z",t.viewbox=""+-1*r/5+" "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"reverse-start":l=0,a=2*r,c=-1*r/2,s=r/2,t.markerHeight=r,t.markerWidth=2*r,t.path="M 0,0 m 0,"+c+" L "+a+",0 L 0,"+s+" z",t.viewbox=""+l+" "+c+" "+t.markerWidth+" "+t.markerHeight;break;case"reverse-end":l=-2*r,c=-1*r/2,s=r/2,t.markerHeight=1*r,t.markerWidth=2*r,t.path="M 0,0 m 0,"+c+" L "+l+",0 L 0,"+s+" z",t.viewbox=""+l+" "+c+" "+t.markerWidth+" "+t.markerHeight}},n}(i)}),require.register("views/node-view",function(t,e,n){var r,i,o,a,s,u,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};s=e("mediator"),a=e("views/base/view"),i=e("models/path"),o=e("models/text"),n.exports=r=function(t){function e(){return this.generate_shape=l(this.generate_shape,this),this.build_paths=l(this.build_paths,this),this.activate_path=l(this.activate_path,this),this.path_dragend=l(this.path_dragend,this),this.path_drag=l(this.path_drag,this),this.path_dragstart=l(this.path_dragstart,this),this.drag_path_handle_end=l(this.drag_path_handle_end,this),this.drag_path_handle_move=l(this.drag_path_handle_move,this),this.drag_path_handle_start=l(this.drag_path_handle_start,this),this.build_path_handles=l(this.build_path_handles,this),this.build_path_bounds=l(this.build_path_bounds,this),this.build_line_breaks=l(this.build_line_breaks,this),this.set_text=l(this.set_text,this),this.activate_text=l(this.activate_text,this),this.text_inline_edit=l(this.text_inline_edit,this),this.text_dragend=l(this.text_dragend,this),this.text_drag=l(this.text_drag,this),this.text_dragstart=l(this.text_dragstart,this),this.drag_text_handle_end=l(this.drag_text_handle_end,this),this.drag_text_handle_move=l(this.drag_text_handle_move,this),this.drag_text_handle_start=l(this.drag_text_handle_start,this),this.build_text_handles=l(this.build_text_handles,this),this.build_text_bounds=l(this.build_text_bounds,this),this.deactivate_controls=l(this.deactivate_controls,this),this.build_controls=l(this.build_controls,this),this.rebuild=l(this.rebuild,this),this.deactivate=l(this.deactivate,this),this.refresh=l(this.refresh,this),u=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.autoRender=!0,e.prototype.initialize=function(t){return null==t&&(t={}),e.__super__.initialize.apply(this,arguments),this.view=d3.select(this.el),this.padding=20,this.selected_text=null,this.active_text=null,this.resizing_text=!1,this.selected_path=null,this.active_path=null,this.resizing_path=!1,this.subscribeEvent("clear_active",this.deactivate),this.listenTo(this.model,"sync",this.refresh)},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.build_paths(),this.build_texts(),this.build_bounding_box(),console.log("[NodeView Rendered]")},e.prototype.remove=function(){return this.deactivate(),console.log("[NodeView Removed]"),e.__super__.remove.apply(this,arguments)},e.prototype.refresh=function(){return console.log(" ⟲ Model changed.. refreshing"),this.deactivate_controls(),this.render(),this.build_controls(),null!=this.active_text&&this.build_text_handles(this.active_text.model,this.active_text.index),null!=this.active_path?this.build_path_handles(this.active_path.model,this.active_path.index):void 0},e.prototype.activate=function(t){return console.log("Activating node..."),this.view.classed("active",!0),this.build_controls(),null!=t&&(t instanceof i&&(this.selected_path={model:t,index:this.model.paths.indexOf(t)},this.activate_path(this.selected_path.model,this.selected_path.index)),t instanceof o)?(this.selected_text={model:t,index:this.model.texts.indexOf(t)},this.activate_text(this.selected_text.model,this.selected_text.index)):void 0},e.prototype.deactivate=function(){return console.log("Deactivating node..."),this.view.classed("active",!1),this.deactivate_controls(),this.selected_text=null,this.active_text=null,this.resizing_text=!1,this.selected_path=null,this.active_path=null,this.resizing_path=!1},e.prototype.rebuild=function(){return this.deactivate(),this.text.remove(),this.path.remove(),this.refresh()},e.prototype.build_controls=function(){var t=this;return this.text.call(d3.behavior.drag().on("dragstart",this.text_dragstart).on("drag",this.text_drag).on("dragend",this.text_dragend)),this.path,this.view.select("path.origin").remove(),this.origin=this.view.selectAll("path.origin").data([{}]),this.origin.enter().insert("path","g.nodeText").attr("class","origin").attr("pointer-events","none").attr("fill","none").attr("d","M 0,-12 L 0,12 M -12,0 L 12,0").style("stroke-dasharray","4,1"),s.controls.selectAll("g#node_controls").remove(),this.controls=s.controls.append("svg:g").attr("id","node_controls").attr("transform",function(){return"translate("+t.model.get("x")+","+t.model.get("y")+") rotate("+t.model.get("rotate")+")"}),this.text_controls=this.controls.selectAll("g.node_text_controls").data(this.model.texts.models),this.text_controls.enter().append("svg:g").attr("class","node_text_controls").each(function(e,n){return t.build_text_bounds(e,n)}),this.path_controls=this.controls.selectAll("g.node_path_controls").data(this.model.paths.models),this.path_controls.enter().append("svg:g").attr("class","node_path_controls").attr("transform",function(t){return"rotate("+t.get("rotate")+")"}).each(function(e,n){return t.build_path_bounds(e,n)})},e.prototype.deactivate_controls=function(){var t,e,n,r,i,o,a,s;return this.text.call(d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null)),this.path,null!=(t=this.text_bounding_box)&&t.remove(),null!=(e=this.text_handles)&&e.call(d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null)).remove(),null!=(n=this.text_controls)&&n.remove(),null!=(r=this.path_bounding_box)&&r.remove(),null!=(i=this.path_handles)&&i.call(d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null)).remove(),null!=(o=this.path_controls)&&o.remove(),null!=(a=this.origin)&&a.remove(),null!=(s=this.controls)?s.remove():void 0},e.prototype.build_bounding_box=function(){var t=this;return this.view.select("rect.parent_bounds").remove(),setTimeout(function(){var e;return e=t.view[0][0].getBBox(),t.view.selectAll("rect.parent_bounds").data([{}]).enter().insert("rect","g.nodePath").attr("class","parent_bounds").attr("fill","none").attr("height",function(){return e.height+t.padding}).attr("width",function(){return e.width+t.padding}).attr("x",function(){return e.x-t.padding/2}).attr("y",function(){return e.y-t.padding/2})},250)},e.prototype.build_text_bounds=function(t,e){var n,r,i,o;return n=d3.select(this.text[0][e])[0][0].getBBox().height,r=parseInt(t.get("width")),i=parseInt(t.get("x")),o=parseInt(t.get("y")),this.text_controls.selectAll("rect.bounding_box").remove(),this.text_bounding_box=this.text_controls.selectAll("rect.bounding_box").data([t]),this.text_bounding_box.enter().append("svg:rect").attr("class","bounding_box").attr("pointer-events","none").attr("fill","none").attr("x",i-r/2).attr("y",o-n/2).attr("height",n).attr("width",r)},e.prototype.build_text_handles=function(t,e){var n,r,i,o,a;return r=d3.select(this.text[0][e])[0][0].getBBox().height,i=parseInt(t.get("width")),o=parseInt(t.get("x")),a=parseInt(t.get("y")),n=[],n[0]={x:o-i/2,y:a-r/2},n[1]={x:o+i/2,y:a-r/2},this.text_controls.select("rect").attr("class","bounding_box active"),this.text_handles=this.text_controls.selectAll("circle.handle").data(n),this.text_handles.enter().append("svg:circle").attr("class","handle").attr("cx",function(t){return t.x
}).attr("cy",function(){return a}).attr("r",5).call(d3.behavior.drag().on("dragstart",this.drag_text_handle_start).on("drag",this.drag_text_handle_move).on("dragend",this.drag_text_handle_end))},e.prototype.drag_text_handle_start=function(){return d3.event.sourceEvent.stopPropagation()},e.prototype.drag_text_handle_move=function(){var t,e,n,r;return d3.event.sourceEvent.stopPropagation(),this.resizing_text=!0,r=parseInt(this.text_controls.data()[0].get("x")),t=50,e=2*Math.abs(r-d3.event.x),n=Math.max(e,t),this.text_bounding_box.attr("width",n).attr("x",function(){return r-n/2}),d3.select(this.text_handles[0][0]).attr("cx",r-n/2),d3.select(this.text_handles[0][1]).attr("cx",r+n/2)},e.prototype.drag_text_handle_end=function(){var t,e;return d3.event.sourceEvent.stopPropagation(),e=parseInt(this.text_controls.data()[0].get("x")),t=this.text_bounding_box.attr("width"),this.resizing_text?this.text_controls.data()[0].set({width:Math.round(t)}):void 0},e.prototype.text_dragstart=function(t){return null!=this.selected_text&&d3.event.sourceEvent.stopPropagation(),null!=this.active_text?(t.px=t.get("x"),t.py=t.get("y")):void 0},e.prototype.text_drag=function(t,e){return d3.event.sourceEvent.stopPropagation(),null!=this.active_text?(t.px=Math.round(d3.event.x),t.py=Math.round(d3.event.y),t.px>-7&&7>t.px&&(t.px=0),t.py>-7&&7>t.py&&(t.py=0),d3.select(this.text[0][e]).attr("transform","translate("+t.px+","+t.py+")"),d3.select(this.text_controls[0][0]).attr("transform","translate("+(t.px-t.get("x"))+","+(t.py-t.get("y"))+")")):void 0},e.prototype.text_dragend=function(t){return d3.event.sourceEvent.stopPropagation(),null!=this.active_text?t.set({x:t.px,y:t.py}):void 0},e.prototype.text_inline_edit=function(t,e){var n,r;return"undefined"!=typeof SVGForeignObjectElement&&d3.event.stopPropagation(),r=d3.select(this.text_controls[0][e])[0][0].getBoundingClientRect(),n=this.model.texts.models[e],d3.select("#stage").append("textarea").attr("id","editable_node_label").html(n.get("text")).style("background","#fff").style("text-align",function(){var t;return t=n.get("align"),"end"===t?"right":void 0}).style("height",r.height+"px").style("left",r.left+5+"px").style("top",r.top+"px").style("width",n.get("width")+"px")},e.prototype.activate_text=function(t,e){var n=this;return this.active_text={model:t,index:e},this.text_controls.each(function(){return n.build_text_handles(t,e)}),setTimeout(function(){return n.publishEvent("activate_text",0)})},e.prototype.build_texts=function(){var t=this;return this.text=this.view.selectAll("g.nodeText").data(this.model.texts.models),this.text.enter().append("svg:g").attr("class","nodeText").append("svg:g").attr("class","paragraph"),this.text.attr("transform",function(t){return"translate("+t.get("x")+","+t.get("y")+")"}).selectAll("g.paragraph").attr("fill",function(t){return t.get("fill")}).attr("fill-opacity",function(t){return t.get("fill_opacity")/100}).attr("stroke",function(t){return t.get("stroke")}).attr("stroke-opacity",function(t){return t.get("stroke_opacity")/100}).attr("font-family","Helvetica, sans-serif").attr("font-size",function(t){return t.get("font_size")}).attr("font-style",function(t){return t.get("italic")?"italic":"normal"}).attr("font-weight",function(t){return t.get("bold")?"bold":"normal"}).attr("text-decoration",function(t){var e;return e=[],t.get("underline")&&e.push("underline"),t.get("overline")&&e.push("overline"),e.join(" ")}).attr("letter-spacing",function(t){return t.get("spacing")}).attr("stroke-width",function(t){return t.get("stroke_width")}).each(function(e,n){return t.set_text(e,n)}),this.text.exit().remove()},e.prototype.set_text=function(t,e){var n,r,i,o,a,s,u,l=this;return u=t.get("text").split(" "),u.length>0?(a=d3.select(this.text[0][e]).selectAll("g.paragraph"),s=parseInt(t.get("width")),i=[""],r=[""],o="",n=0,_.each(u,function(e){return r[n]=_.clone(i[n]),r[n]+=e+" "+"",l.build_line_breaks(a,t,r),s>a[0][0].getBBox().width?i[n]+=e+" "+"":(i.push(""),r[n]=i[n],n+=1,i[n]+=e+" "+"",l.build_line_breaks(a,t,i))})):void 0},e.prototype.build_line_breaks=function(t,e,n){var r,i,o,a,s;return r=e.get("font_size"),i=e.get("line_height"),a=e.get("align"),s=e.get("width"),t.selectAll("text.artifact").remove(),o=t.selectAll("text.artifact").data(n),o.enter().append("svg:text").attr("class","artifact"),o.attr("text-anchor",a).attr("x",function(){return"start"===a?-(s/2):"end"===a?s/2:0}).attr("y",function(t,e){return i*e}).text(function(t){return(t+"").trim()}),t.attr("transform",function(){return"translate(0,"+(-i*(n.length-1)/2+.3*r)+")"})},e.prototype.build_path_bounds=function(t){var e,n,r,i;return e=parseInt(t.get("height")),n=parseInt(t.get("width")),r=parseInt(t.get("x")),i=parseInt(t.get("y")),this.path_controls.selectAll("rect.bounding_box").remove(),this.path_bounding_box=this.path_controls.selectAll("rect.bounding_box").data([t]),this.path_bounding_box.enter().append("svg:rect").attr("class","bounding_box").attr("pointer-events","none").attr("fill","none").attr("x",r-n/2).attr("y",i-e/2).attr("height",e).attr("width",n)},e.prototype.build_path_handles=function(t){var e,n,r,i,o;return n=parseInt(t.get("height")),r=parseInt(t.get("width")),i=parseInt(t.get("x")),o=parseInt(t.get("y")),e=[],e[0]={x:i-r/2,y:o-n/2},e[1]={x:i+r/2,y:o-n/2},e[2]={x:i+r/2,y:o+n/2},e[3]={x:i-r/2,y:o+n/2},this.path_controls.select("rect").attr("class","bounding_box active"),this.path_handles=this.path_controls.selectAll("circle.handle").data(e),this.path_handles.enter().append("svg:circle").attr("class","handle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",5).call(d3.behavior.drag().on("dragstart",this.drag_path_handle_start).on("drag",this.drag_path_handle_move).on("dragend",this.drag_path_handle_end))},e.prototype.drag_path_handle_start=function(){return d3.event.sourceEvent.stopPropagation()},e.prototype.drag_path_handle_move=function(){var t,e,n,r,i,o,a,s;return d3.event.sourceEvent.stopPropagation(),this.resizing_path=!0,t=parseInt(this.path_controls.data()[0].get("height")),i=parseInt(this.path_controls.data()[0].get("width")),a=parseInt(this.path_controls.data()[0].get("x")),s=parseInt(this.path_controls.data()[0].get("y")),n=2*Math.abs(s-d3.event.y),r=key.shift?i*(n/t):2*Math.abs(a-d3.event.x),e=Math.max(n,20),o=Math.max(r,20),this.path_bounding_box.attr("height",e).attr("width",o).attr("x",function(){return a-o/2}).attr("y",function(){return s-e/2}),d3.select(this.path_handles[0][0]).attr("cx",a-o/2).attr("cy",s-e/2),d3.select(this.path_handles[0][1]).attr("cx",a+o/2).attr("cy",s-e/2),d3.select(this.path_handles[0][2]).attr("cx",a+o/2).attr("cy",s+e/2),d3.select(this.path_handles[0][3]).attr("cx",a-o/2).attr("cy",s+e/2)},e.prototype.drag_path_handle_end=function(){var t,e,n,r;return d3.event.sourceEvent.stopPropagation(),n=parseInt(this.path_controls.data()[0].get("x")),r=parseInt(this.path_controls.data()[0].get("y")),t=this.path_bounding_box.attr("height"),e=this.path_bounding_box.attr("width"),this.resizing_path?this.path_controls.data()[0].set({height:Math.round(t),width:Math.round(e)}):void 0},e.prototype.path_dragstart=function(t){return null!=this.selected_path&&d3.event.sourceEvent.stopPropagation(),null!=this.active_path?(t.px=t.get("x"),t.py=t.get("y")):void 0},e.prototype.path_drag=function(t,e){return d3.event.sourceEvent.stopPropagation(),null!=this.active_path?(t.px=Math.round(d3.event.x),t.py=Math.round(d3.event.y),d3.select(this.path[0][e]).attr("transform","translate("+t.px+","+t.py+") rotate("+t.get("rotate")+")"),d3.select(this.path_controls[0][0]).attr("transform","translate("+(t.px-t.get("x"))+","+(t.py-t.get("y"))+")")):void 0},e.prototype.path_dragend=function(t){return d3.event.sourceEvent.stopPropagation(),null!=this.active_path?t.set({x:t.px,y:t.py}):void 0},e.prototype.activate_path=function(t,e){var n=this;return this.active_path={model:t,index:e},this.path_controls.each(function(){return n.build_path_handles(t,e)}),setTimeout(function(){return n.publishEvent("activate_path",0)})},e.prototype.build_paths=function(){var t=this;return this.path=this.view.selectAll("g.nodePath").data(this.model.paths.models),this.path.enter().append("svg:g").attr("class","nodePath").append("svg:path").attr("class","artifact"),this.path.attr("transform",function(t){return"translate("+t.get("x")+","+t.get("y")+") rotate("+t.get("rotate")+")"}).selectAll("path.artifact").each(function(e){return t.generate_shape(e)}).attr("d",function(t){return t.path}).attr("fill",function(t){return t.get("fill")}).attr("fill-opacity",function(t){return t.get("fill_opacity")/100}).attr("stroke",function(t){return"none"===t.get("shape")?"none":t.get("stroke")}).attr("stroke-dasharray",function(t){return t.get("stroke_dasharray").join()}).attr("stroke-linecap",function(t){return t.get("stroke_linecap")}).attr("stroke-linejoin",function(t){var e;return e=t.get("stroke_linecap"),"square"===e?"miter":"butt"===e?"bevel":e}).attr("stroke-opacity",function(t){return t.get("stroke_opacity")/100}).attr("stroke-width",function(t){return t.get("stroke_width")}),this.path.exit().remove()},e.prototype.generate_shape=function(t){var e,n,r;switch(n=t.get("shape"),e=t.get("height"),r=t.get("width"),n){case"none":t.path="M 0,0 L 0,0 Z";break;case"circle":t.path="M 0,0 m "+-r/2+", 0 "+"a "+r/2+","+e/2+" 0 1,0 "+r+",0 "+"a "+r/2+","+e/2+" 0 1,0 "+-r+",0";break;case"square":t.path="M "+-r/2+","+-e/2+" "+"L "+r/2+","+-e/2+" "+"L "+r/2+","+e/2+" "+"L "+-r/2+","+e/2+" Z";break;case"hexagon":t.path="M 0,"+-e/2+" "+"L "+r/2+","+-e/4+" "+"L "+r/2+","+e/4+" "+"L 0,"+e/2+" "+"L "+-r/2+","+e/4+" "+"L "+-r/2+","+-e/4+" Z";break;case"triangle":t.path="M 0,"+-e/2+" "+"L "+r/2+","+e/2+" "+"L "+-r/2+","+e/2+" Z";break;case"plus":t.path="M "+.5*-r+","+.2*-e+" "+"L "+.2*-r+","+.2*-e+" "+"L "+.2*-r+","+.5*-e+" "+"L "+.2*r+","+.5*-e+" "+"L "+.2*r+","+.2*-e+" "+"L "+.5*r+","+.2*-e+" "+"L "+.5*r+","+.2*e+" "+"L "+.2*r+","+.2*e+" "+"L "+.2*r+","+.5*e+" "+"L "+.2*-r+","+.5*e+" "+"L "+.2*-r+","+.2*e+" "+"L "+.5*-r+","+.2*e+" Z"}},e}(a)}),require.register("views/templates/canvas",function(t,e,n){n.exports=Handlebars.template(function(t,e,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,t.helpers),i=i||{},'<div id="stage"></div>'})});
//@ sourceMappingURL=app.js.map